---
title: "free() 内存释放"
author: "Roser"
date: 2025-05-09
image: "images/content/OS.png"
draft: false
tags:
  - OS
  - Cpp
  - Review
  - Todo
sr-due: 2025-05-14
sr-interval: 30
sr-ease: 250
---
`free()` 与 [`malloc()`](malloc()%20内存分配.md) 一定是成对出现的，从而避免占用内存没有及时释放导致内存泄漏。

- `brk()` 申请的内存，在使用 `free()` 回收时，操作系统实际会保留已经申请的堆内存，以便后续复用。
- `mmap()` 申请的内存，使用 `free()` 回收时，操作系统会实际回收已申请的内存。后续申请会重新分配。

> 进程关闭时，操作系统会回收所有内存。

申请内存时，如果仔细看一下，会发现 `malloc()` 申请的内存实际可用的起始地址会偏移 16 个**字节**，作为内存块的头信息，`free` 释放时，会根据头信息中存储的内存大小，精确释放当前指针指向的内存。

> 这里的偏移是每次 `malloc()` 指定分配内存时都有的，而不是操作系统实际分配的 132KB 内存。