---
title: "4GB 物理内存的机器上申请 8GB 内存会怎么样"
author: "Roser"
date: 2025-04-14
image: "images/content/OS.png"
draft: false
tags:
  - Interview
  - OS
  - Review
  - Draft
sr-due: 2025-05-10
sr-interval: 26
sr-ease: 252
---
要区分操作系统的位数，申请后的内存是否使用，以及操作系统是否使用 Swap 机制。
### 操作系统的影响

在 [Linux 系统虚拟内存空间分布](../Memory/Linux%20系统虚拟内存空间分布.md) 有看过不同位数的操作系统内存分布。对于 32 位 Linux 系统，只有 3GB 大小的虚拟内存可以被用户使用，直接申请超过 3GB 大小的内存会失败。

> 32 位 Windows 系统下，用户可用内存只有 2GB 左右。

即使分别申请，在申请超过虚拟内存大小的内存时也会失败。

对于 64 位系统，理论上有 128TB 的用户虚拟内存可用，但是一次性申请较大内存很可能会触发操作系统的保护机制从而导致分配失败。可以通过一些方式解除安全限制，这种情况下就可以直接申请大内存了。

> 并不是一定会有安全限制，也不一定什么情况下会限制并提示申请内存失败，这个没有一个标准。
### 物理内存装载

假如申请了很大的内存，但是没有使用这部分内存，是不会将其装载到物理内存的。只有读写这部分内存时，才会将读写的内存装载进物理内存。

装载到物理内存后，就需要考虑物理内存的限制了。

如果操作系统启用了 Swap 机制，则当前访问的内存量超过物理内存时，会进行内存与磁盘的换入换出，即进行[内存回收](内存回收.md)。

如果内存回收的能力达不到当前程序的使用需求，则会触发 OOM 关闭内存占用量大的程序。

> OOM 关闭是按照算法计算的，是操作系统来控制。如果当前进程一直在申请并使用大内存，则当前进程就会被 OOM 关闭以回收内存。
> 
> 因此如果进行上面的实验，会在使用内存量较大时出现操作系统 Kill 的情况。