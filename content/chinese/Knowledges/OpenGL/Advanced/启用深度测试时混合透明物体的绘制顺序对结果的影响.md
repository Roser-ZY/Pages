---
title: "启用深度测试时混合透明物体的绘制顺序对结果的影响"
author: "Roser"
date: 2025-04-14
image: "images/content/OpenGL.png"
draft: false
tags:
  - OpenGL
  - DepthTest
  - Blend
  - Review
sr-due: 2025-05-12
sr-interval: 28
sr-ease: 250
---
如果启用[深度测试](深度缓冲.md)，并且存在透明物体，如果绘制顺序没有进行控制的话，实际运行效果可能会存在奇怪的现象，比如某些透明物体完全遮挡了后面的物体。

通过控制绘制顺序，可以解决这种遮挡问题。顺序如下：
1. 先绘制不透明物体。
2. 对透明物体按照由远到近的顺序进行绘制。

在解释这个问题之前，先明确混合的实现原理和深度测试。混合实际上是将透明物体上，遮挡后面物体的那个片段，通过颜色混合从而确定片段的实际颜色，绘制透明物体之后，看上去像是透过透明物体看到了后面的物体一样，实际上可以看做是把后面的物体画在了前面的透明物体上。

> 这个只是为了更好的理解这个问题，实际上片段只是屏幕上的像素而已。简单来说，混合就是在某个像素把被挡住的颜色进行混合后绘制。

深度测试则简单粗暴，通过比较片段深度值，从而确定抛弃还是保留片段。

如果不排序，假如某个不透明物体 A 没有先绘制，此时先绘制了透明物体 B，则 B 做混合的时候，会将背景色（简单一点，即什么都没有的颜色，可能有光照之类的计算结果）混合，然后绘制 A 的时候，由于深度测试，它被 B 遮挡的部分被抛弃了，而 A 已经绘制并且混合过了，不会再去混合 B 的颜色，所以才造成遮挡的情况。

了解这些后，通过排序解决奇怪的遮挡问题就比较易懂了。排序本身和深度测试无关，深度测试还是正常运行。排序影响的是混合的顺序。

在绘制透明物体并进行混合时，是将当前绘制的片段值**原有颜色**和**透明物体颜色**进行混合，先绘制不透明物体，然后透明物体从远到近绘制时，片段上已经有了正确的片段颜色，此时混合就能够将被遮挡的物体透过透明物体绘制出来。