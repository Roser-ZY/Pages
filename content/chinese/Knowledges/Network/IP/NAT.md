---
title: "NAT"
author: "Roser"
date: 2025-04-07
image: "images/content/Network.png"
draft: false
tags:
  - Network
  - IP
  - Review
  - Draft
sr-due: 2025-05-13
sr-interval: 36
sr-ease: 270
---
由于 IPv4 地址紧缺，因此提出了一种网络地址转换的方法，即 NAT，来缓解 IP 紧缺。

NAT 简单来说就是在同一个私有网络内的主机对外通信时，将私有 IP 转换为公有 IP 的技术。

> 当然不只是单纯的 IP 转换，不然私网有多少主机就需要多少公网 IP，反而加剧紧缺。

绝大多数网络数据使用传输层协议传输，因此可以将 IP 地址 和 端口号 一起进行转换，这样只需要使用一个公网 IP，通过端口划分私网内的不同 IP 地址。该技术称为网络地址与端口转换，即 NAPT。

例如 `192.168.1.1:1025` 和 `192.168.1.2:1026`，经过 NAPT 之后对外暴露为 `120.229.175.121:1025` 和 `120.229.175.121:1026`。

转换的对应关系会存放在路由器的 NAPT 转换表中。

NAPT 能够大大缓解公网 IP 紧张的问题，但同样也有自己的问题。
- 外部无法主动与 NAT 内部设备建立连接，因为 NAPT 转换表只记录实时转换数据，并不进行持久化。
- 转换表的生成与转换操作会产生性能开销。
- 如果 NAPT 路由器重启，则所有 TCP 连接都将被重置。

解决这类问题的方法，除了改用 IPv6，还可以进行 NAT 穿透。
### NAT 穿透

NAT 穿透能够让网络内的主机（设备）主动发现自己被一个 NAT 设备（即 NAT 路由器）进行了地址转换，则该主机会**主动**向 NAT 路由器请求并获得 NAT 设备中存储的映射后的公网 IP，并为自己建立端口映射条目。

后续主机会使用这些条目对外通信，不需要 NAT 设备再进行转换。
***
简单来说，NAT 是路由器被动进行的操作，主机感知不到，外界也无法主动与主机进行通讯。NAT 穿透则是主机主动的行为，为的是让外界能够主动联系到自己。