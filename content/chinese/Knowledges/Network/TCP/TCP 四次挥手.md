---
title: "TCP 四次挥手"
author: "Roser"
date: 2025-05-09
image: "images/content/Network.png"
draft: false
tags:
  - Network
  - TCP
  - Review
sr-due: 2025-08-06
sr-interval: 103
sr-ease: 252
---
四次挥手是 TCP 断开连接的方式。与 [TCP 三次握手](../TCP-三次握手)不同，四次挥手时双方都可以主动断开连接。

![](images/四次挥手.png)

- **第一次挥手**（客户端发送 FIN 报文）： 客户端向服务器发送一个带有 FIN 标志的报文，表示客户端已经完成数据发送，并希望关闭连接。发送完这个报文后，客户端进入 FIN-WAIT-1 状态，等待服务器的回应。

- **第二次挥手**（服务器发送 ACK 报文）： 服务器收到客户端的 FIN 报文后，发送一个带有 ACK 标志的报文，表示它收到了客户端的请求，并同意关闭连接，但此时服务器还可能有未发送完的数据，因此服务器进入 CLOSE-WAIT 状态，客户端收到这个 ACK 报文后进入 FIN-WAIT-2 状态。

- **第三次挥手**（服务器发送 FIN 报文）： 当服务器也完成了数据的传输后，它向客户端发送一个带有 FIN 标志的报文，表示服务器也准备关闭连接。发送完这个报文后，服务器进入 LAST-ACK 状态，等待客户端的最终确认。

- **第四次挥手**（客户端发送 ACK 报文）： 客户端收到服务器的 FIN 报文后，发送一个带有 ACK 标志的报文作为确认，表示连接已经关闭。发送完这个报文后，客户端进入 TIME-WAIT 状态，此时连接并未立即释放，而是要等待一段时间（通常是 2 倍的最大报文段生存时间，2MSL），以确保服务器能够接收到这个 ACK 报文。等待时间结束后，客户端才进入 CLOSED 状态，正式关闭连接。服务器收到这个 ACK 报文后，也进入 CLOSED 状态，连接关闭。

上面示意图中，展示的是客户端主动断开连接（这是比较常见的情况），但是实际上也可以由服务端主动断开连接，此时上面的各个状态需要交换。示意图中的服务端和客户端，应该理解为被动断开连接方与主动断开连接方。