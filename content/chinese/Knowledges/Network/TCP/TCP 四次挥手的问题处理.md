---
title: "TCP 四次挥手的问题处理"
author: "Roser"
date: 2025-03-12
image: "images/content/Network.png"
draft: false
tags:
  - Network
  - TCP
  - Review
sr-due: 2025-04-22
sr-interval: 41
sr-ease: 250
---
[TCP 四次挥手](TCP%20四次挥手.md)也是非常可靠的断开连接的方式，挥手过程中网络出现问题的处理方案如下。

| 节点    | 问题                        | 处理方式                                                          | 失败结果              |
| ----- | ------------------------- | ------------------------------------------------------------- | ----------------- |
| 第一次挥手 | 客户端 FIN 报文丢失。             | 客户端重传 FIN。                                                    | 客户端超过重传次数后放弃连接。   |
| 第二次挥手 | 客户端 ACK 报文丢失。             | 客户端未收到 ACK，重传 FIN。                                            | 客户端超过重传次数后放弃连接。   |
| 第三次挥手 | 服务端 FIN 报文丢失。             | 服务端未收到 ACK，重传 FIN。                                            | 服务端超过重传仍未响应，关闭连接。 |
|       | 服务端重新收到客户端的 FIN 报文。       | 说明客户端未收到服务端发送的 ACK 报文，重新发送 ACK，此时服务端的状态不会因为收到 FIN 而更改，保留当前状态。 | 无                 |
|       | 客户端未收到服务端 ACK，但收到服务端 FIN。 | 此时客户端会跳过 FIN-WAIT-2 阶段，直接进入 TIME-WAIT 阶段。                     | 无                 |
| 第四次挥手 | 客户端 ACK 报文丢失。             | 服务端未收到 ACK，会重新发送 FIN。                                         | 服务端超过重传次数，关闭连接。   |
如果最后服务端因为网络问题没有收到 ACK 报文，并且客户端已经关闭连接，此时服务端会再次发送 FIN 报文，直到超时后会自行关闭连接。

这种情况在高并发时会导致大量冗余 FIN 报文进入网络，并且阻塞服务端接受新的连接（因为端口仍被占用）。