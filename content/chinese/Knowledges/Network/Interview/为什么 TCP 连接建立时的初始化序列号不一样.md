---
title: "为什么 TCP 连接建立时的初始化序列号不一样"
author: "Roser"
date: 2025-02-14
image: "images/content/Network.png"
draft: false
tags:
  - Network
  - TCP
---
- 为了防止历史报文被下一个相同四元组的连接接受（主要方面）。
- 为了安全性，防止黑客伪造相同序列号的 TCP 报文被对方接收。

看下主要方面。假如目前有一个 TCP 连接已建立，客户端发送了消息，但是被阻塞，并且阻塞过程中，服务端重启，导致连接关闭。

此时，客户端发现迟迟没有收到响应，重传了被阻塞的消息，而此时发现服务端重启，因此重新建立连接。

假如初始化序列号相同，则第二次建立的连接，初始化序列号及可接受报文序列号（在窗口内）与第一次连接相同，假如建立连接后，历史阻塞的报文到达服务端，此时由于该历史报文的序列号在窗口内，服务端误认为是本次连接的数据，便接受处理了，此时会产生错误。

如果初始化序列号不一致，第二次建立的连接，可接受的报文序列号**很大概率**是不包含前一次连接的历史数据序列号的，因此可以大大减少错误收报的概率。

但是这只是减少概率，避免错误接收历史报文还需要其他手段来保障。